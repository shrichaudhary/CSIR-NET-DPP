<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSIR-NET Physical Science | SHODH 2.0</title>
    
    <!-- MathJax for Physics Formulas -->
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="app-loader" class="loader-overlay">
        <div style="text-align:center;">
            <div class="spinner"></div>
            <p style="margin-top:10px;">Connecting to Physics Server...</p>
        </div>
    </div>

    <nav>
        <div class="brand">‚öõÔ∏è CSIR-NET Physics Hub</div>
        <div class="nav-right">
            <button class="btn btn-outline" onclick="window.goToHome()">Home</button>
            <div id="nav-auth-buttons" class="nav-group">
                <button class="btn btn-outline" onclick="window.showUserAuth()">Student Login</button>
                <button class="btn btn-outline" onclick="window.toggleAdminAuth()">Admin</button>
            </div>
            <div id="nav-user-profile" class="nav-profile hidden">
                <span id="nav-username">User</span>
                <button class="btn btn-danger btn-small" onclick="window.logoutUser()">Logout</button>
            </div>
        </div>
    </nav>

    <!-- SECTION: HOME -->
    <div id="section-home" class="container">
        <div class="card hero">
            <h2>CSIR-NET Physical Science (SHODH 2.0)</h2>
            <p>Advanced DPPs for Quantum Mechanics, Classical Mechanics & Mathematical Physics.</p>
            
            <!-- RESUME ALERT BOX (Fixed) -->
            <div id="resume-alert" class="resume-box hidden">
                <div style="flex:1">
                    <strong>‚ö†Ô∏è Unfinished Attempt Found</strong><br>
                    <small>You have a paused session for <span id="resume-quiz-title">Test</span></small>
                </div>
                <button class="btn btn-warning" onclick="window.resumeLastSession()">Resume Test ‚èØÔ∏è</button>
                <button class="btn btn-outline" style="border-color:#333; color:#333; margin-left:5px;" onclick="window.discardSession()">Discard</button>
            </div>

            <button class="btn btn-success" id="hero-action-btn" onclick="window.showUserAuth()">Login / Register</button>
        </div>
        
        <h3>Available DPPs (Live)</h3>
        <div id="quiz-list-container" class="grid">
            <p class="muted">Loading Physics modules...</p>
        </div>
    </div>

    <!-- SECTION: AUTH -->
    <div id="section-user-auth" class="container hidden">
        <div class="card auth-box">
            <div class="tab-row">
                <button class="tab-btn active" id="tab-login" onclick="window.switchAuthTab('login')">Login</button>
                <button class="tab-btn" id="tab-register" onclick="window.switchAuthTab('register')">Register</button>
            </div>
            <div id="auth-form-login">
                <h3>Aspirant Login</h3>
                <input type="email" id="loginEmail" class="input-field" placeholder="Email" autocomplete="username">
                <input type="password" id="loginPass" class="input-field" placeholder="Password" autocomplete="current-password">
                <button class="btn btn-primary" style="width:100%; margin-top:10px;" onclick="window.loginUser()">Login</button>
            </div>
            <div id="auth-form-register" class="hidden">
                <h3>New Registration</h3>
                <input type="email" id="regEmail" class="input-field" placeholder="Email Address" autocomplete="username">
                <input type="text" id="regUser" class="input-field" placeholder="Full Name">
                <input type="password" id="regPass" class="input-field" placeholder="Password" autocomplete="new-password">
                <button class="btn btn-success" style="width:100%; margin-top:10px;" onclick="window.registerUser()">Register</button>
            </div>
        </div>
    </div>

    <!-- SECTION: USER DASHBOARD -->
    <div id="section-user-dashboard" class="container hidden">
        <div class="card">
            <h2 class="primary">üë§ My Dashboard</h2>
            <p>Welcome back, <strong id="dash-username">User</strong></p>
        </div>
        <div class="grid two">
            <div class="card warning">
                <h3>‚è≥ Pending Reviews</h3>
                <p class="muted">Subjective answers waiting for checking.</p>
                <div id="dash-pending-list">Loading...</div>
            </div>
            <div class="card success">
                <h3>‚úÖ Completed Tests</h3>
                <p class="muted">Your live results.</p>
                <div id="dash-history-list">Loading...</div>
            </div>
        </div>
    </div>

    <!-- SECTION: ADMIN LOGIN -->
    <div id="section-admin-login" class="container hidden">
        <div class="card auth-box">
            <h2>üîê Faculty Panel</h2>
            <input type="email" id="adminEmail" class="input-field" placeholder="Admin Email">
            <input type="password" id="adminPass" class="input-field" placeholder="Password">
            <button class="btn btn-primary" style="width:100%; margin-top:10px;" onclick="window.verifyAdmin()">Login</button>
        </div>
    </div>

    <!-- SECTION: ADMIN DASHBOARD -->
    <div id="section-admin-dashboard" class="container hidden">
        <div class="admin-top">
            <h2>üë®‚Äçüè´ Faculty Dashboard</h2>
            <div class="row">
                <button class="btn btn-success" onclick="window.showQuizCreator()">+ Create/Upload DPP</button>
                <button class="btn btn-danger" onclick="window.logoutAdmin()">Logout</button>
            </div>
        </div>
        
        <div class="card">
            <h3>üõ†Ô∏è Management Controls</h3>
            <div class="row">
                <button class="btn btn-primary" onclick="window.showStudentManager()">Manage Students</button>
                <button class="btn btn-outline" style="color:#333; border-color:#333;" onclick="window.showAdminManager()">Manage Admins</button>
            </div>
        </div>

        <div class="card warn-border">
            <h3>‚ö†Ô∏è Global Pending Evaluations (<span id="admin-pending-count">0</span>)</h3>
            <div id="pending-eval-list"></div>
        </div>
        <div class="card">
            <h3>Active Physics Modules</h3>
            <div id="admin-quiz-list"></div>
        </div>
    </div>

    <!-- SECTION: STUDENT MANAGER -->
    <div id="section-admin-students" class="container hidden fade-in">
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>üéì Student Management</h2>
                <button class="btn btn-outline" style="color:#333; border-color:#333;" onclick="window.goToAdminDashboard()">Back</button>
            </div>
            <input type="text" id="student-search" class="input-field" placeholder="Search..." onkeyup="window.filterStudents()">
            <div class="table-container">
                <table>
                    <thead><tr><th>Name</th><th>Email</th><th>Actions</th></tr></thead>
                    <tbody id="admin-student-list"></tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- SECTION: QUIZ CREATOR (UPLOAD + MANUAL) -->
    <div id="section-quiz-creator" class="container hidden">
        <div class="card">
            <h3>Create New DPP</h3>
            <div class="panel panel-ok">
                <h4 class="panel-title">üìÇ Upload DPP via JSON</h4>
                <p class="muted">Select your generated .json file (Must include 'questions' array).</p>
                <input type="file" id="jsonQuizInput" accept=".json" onchange="window.uploadQuizJSON(this)">
            </div>
            
            <hr>
            <h4>Or Create Manually</h4>
            <div class="grid three">
                <input type="text" id="newQuizTitle" class="input-field" placeholder="DPP Title">
                <input type="number" id="newQuizTime" class="input-field" placeholder="Time (Mins)">
                <input type="number" id="newQuizMarks" class="input-field" placeholder="Total Marks">
            </div>
            <textarea id="newQuizInstructions" class="input-field" rows="2" placeholder="Instructions..."></textarea>
            
            <!-- Manual Question Addition -->
            <div class="creator-section">
                <h4>Add Question</h4>
                <div class="row">
                    <select id="qType" class="input-field" style="width:auto;" onchange="window.renderAnswerInputs()">
                        <option value="mcq">MCQ</option>
                        <option value="text">Subjective</option>
                    </select>
                </div>
                <textarea id="qText" class="input-field" rows="2" placeholder="Question Text (Supports LaTeX)..."></textarea>
                <div id="answer-inputs-area"></div>
                <textarea id="qSolution" class="input-field" rows="2" placeholder="Solution / Hint (Optional)..."></textarea>
                <button class="btn btn-primary" onclick="window.addQuestionToBuffer()">+ Add Question</button>
            </div>
            
            <div style="margin-top:20px;">
                <h4>Preview (<span id="qCount">0</span>)</h4>
                <div id="questions-buffer-list"></div>
            </div>
            
            <div style="margin-top:20px; text-align:right;">
                <button class="btn btn-danger" onclick="window.goToAdminDashboard()">Cancel</button>
                <button class="btn btn-success" onclick="window.publishQuiz()">üöÄ Publish DPP</button>
            </div>
        </div>
    </div>

    <!-- SECTION: INSTRUCTIONS -->
    <div id="section-instructions" class="container hidden">
        <div class="card centered">
            <h2 id="ins-title">Quiz Title</h2>
            <div class="notice">
                <strong>Instructions:</strong>
                <p id="ins-text" class="small">Read carefully.</p>
                <div>Time: <span id="ins-time"></span> mins | Marks: <span id="ins-marks"></span></div>
            </div>
            <button class="btn btn-success" style="width:100%; margin-top:10px;" onclick="window.startTest()">Start Test</button>
        </div>
    </div>

    <!-- SECTION: ACTIVE QUIZ -->
    <div id="section-active-quiz" class="container hidden">
        <div class="card">
            <div class="question-header">
                <div>
                    <span class="strong">Question <span id="active-q-num">1</span></span>
                    <span class="q-tag" id="active-q-type">MCQ</span>
                </div>
                <div style="display:flex; gap:10px; align-items:center;">
                    <button class="btn btn-warning btn-small" onclick="window.pauseTest()">‚è∏Ô∏è Pause</button>
                    <div class="timer-badge" id="timer-display">00:00</div>
                </div>
            </div>
            <h3 id="active-question-text" class="question-text">Loading...</h3>
            <div id="active-options-area"></div>
            <div class="nav-row">
                <button class="btn btn-primary" id="btn-prev" onclick="window.changeQuestion(-1)">Previous</button>
                <button class="btn btn-success" id="btn-next" onclick="window.changeQuestion(1)">Save & Next</button>
                <button class="btn btn-danger" id="btn-submit" onclick="window.submitTest()" style="display:none;">Submit Test</button>
            </div>
        </div>
        <div class="card">
            <h4>Question Palette</h4>
            <div id="question-grid-target" class="grid-container"></div>
        </div>
    </div>

    <!-- SECTION: RESULT -->
    <div id="section-result" class="container hidden">
        <div class="card center">
            <h2 id="res-status-title">Result</h2>
            <div id="res-score-box">
                <div class="score-big"><span id="res-score">0</span> / <span id="res-total">0</span></div>
            </div>
            <button class="btn btn-primary" onclick="window.checkUserLoginStatus()">Back to Dashboard</button>
        </div>
        <div class="card" id="res-details-card">
            <h3>Detailed Solutions</h3>
            <div id="detailed-report"></div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
